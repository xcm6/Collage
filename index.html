<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Collage Page 1</title>
    <link rel="stylesheet" href="./styles.css">
</head>
<body style="--bg-image: url('./page1/IMG_3943.png');">
    <nav class="nav-fracture" aria-label="navigation">
        <a href="./index.html" data-label="I" class="is-active"><span class="label" data-label="I">I</span></a>
        <a href="./page2.html" data-label="II"><span class="label" data-label="II">II</span></a>
        <a href="./page3.html" data-label="III"><span class="label" data-label="III">III</span></a>
    </nav>
    <div class="corner-id">#202500096</div>
    <div class="corner-label">Thermal Printer & Receipts</div>
    <div class="p1-title" aria-hidden="true" data-text="RECEIPT">RECEIPT</div>
    <main class="canvas" aria-label="Receipt Collage">
        <figure class="piece i1"><img src="./page1/1.png" alt="receipt 1"></figure>
        <figure class="piece i2"><img src="./page1/2.png" alt="receipt 2"></figure>
        <figure class="piece i3"><img src="./page1/3.png" alt="receipt 3"></figure>
        <figure class="piece i4"><img src="./page1/4.png" alt="receipt 4"></figure>
        <figure class="piece i5"><img src="./page1/5.png" alt="receipt 5"></figure>
        <figure class="piece i6"><img src="./page1/6.png" alt="receipt 6"></figure>
        <figure class="piece i7"><img src="./page1/7.png" alt="receipt 7"></figure>
        <figure class="piece i8"><img src="./page1/8.png" alt="receipt 8"></figure>
        <figure class="piece i9"><img src="./page1/9.png" alt="receipt 9"></figure>
        <figure class="piece i10"><img src="./page1/10.png" alt="receipt 10"></figure>
        <figure class="piece i11"><img src="./page1/11.png" alt="receipt 11"></figure>
    </main>
    <script>
    (function() {
        const pieces = Array.from(document.querySelectorAll('.piece'));
        const canvas = document.querySelector('.canvas');
        let dragging = null;
        let startX = 0, startY = 0; // pointer position (px)
        let startLeft = 0, startTop = 0; // element position (vw/vh reference converted to px)
        let zTop = 100;

        function pxToVw(px) { return (px / window.innerWidth) * 100; }
        function pxToVh(px) { return (px / window.innerHeight) * 100; }
        function vwToPx(vw) { return (vw / 100) * window.innerWidth; }
        function vhToPx(vh) { return (vh / 100) * window.innerHeight; }

        function getComputedLeftTop(el) {
            // read current left/top in vw/vh, fallback to px
            const leftStr = getComputedStyle(el).left;
            const topStr = getComputedStyle(el).top;
            let leftPx = 0, topPx = 0;
            if (leftStr.endsWith('vw')) leftPx = vwToPx(parseFloat(leftStr));
            else leftPx = parseFloat(leftStr) || 0;
            if (topStr.endsWith('vh')) topPx = vhToPx(parseFloat(topStr));
            else topPx = parseFloat(topStr) || 0;
            return { leftPx, topPx };
        }

        function onPointerDown(e) {
            const target = e.target.closest('.piece');
            if (!target) return;
            dragging = target;
            const { leftPx, topPx } = getComputedLeftTop(target);
            startLeft = leftPx;
            startTop = topPx;
            startX = e.clientX ?? (e.touches && e.touches[0].clientX) ?? 0;
            startY = e.clientY ?? (e.touches && e.touches[0].clientY) ?? 0;
            zTop += 1;
            dragging.style.zIndex = String(zTop);
            dragging.style.willChange = 'left, top';
            e.preventDefault();
        }

        function onPointerMove(e) {
            if (!dragging) return;
            const clientX = e.clientX ?? (e.touches && e.touches[0].clientX) ?? 0;
            const clientY = e.clientY ?? (e.touches && e.touches[0].clientY) ?? 0;
            const dx = clientX - startX;
            const dy = clientY - startY;
            let newLeftPx = startLeft + dx;
            let newTopPx = startTop + dy;

            // clamp inside viewport
            const rect = dragging.getBoundingClientRect();
            const w = rect.width, h = rect.height;
            const minLeft = -w * 0.2; // 允许少许超出以显得自然
            const minTop = -h * 0.2;
            const maxLeft = window.innerWidth - w * 0.8;
            const maxTop = window.innerHeight - h * 0.8;
            newLeftPx = Math.min(Math.max(newLeftPx, minLeft), maxLeft);
            newTopPx = Math.min(Math.max(newTopPx, minTop), maxTop);

            dragging.style.left = pxToVw(newLeftPx) + 'vw';
            dragging.style.top = pxToVh(newTopPx) + 'vh';
        }

        function onPointerUp() {
            if (!dragging) return;
            dragging.style.willChange = '';
            dragging = null;
        }

        // Mouse
        canvas.addEventListener('mousedown', onPointerDown);
        window.addEventListener('mousemove', onPointerMove);
        window.addEventListener('mouseup', onPointerUp);
        // Touch
        canvas.addEventListener('touchstart', onPointerDown, { passive: false });
        window.addEventListener('touchmove', onPointerMove, { passive: false });
        window.addEventListener('touchend', onPointerUp);
    })();
    </script>
</body>
</html>


